<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ŚABDAKOŚAḤ</title>
        <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 640'><path d='M201.7 291.5C236 310.2 266.2 335.6 290.5 366C301.6 379.9 311.5 394.9 319.9 410.8C328.4 394.9 338.2 380 349.3 366C373.6 335.5 403.8 310.1 438.1 291.5C479.8 268.8 527.5 256 577.8 256L587.7 256C598.8 256 607.8 265 607.8 276.1C607.8 424.1 487.9 544 339.9 544L299.7 544C151.9 544 32 424.1 32 276.1C32 265 41 256 52.1 256L62 256C112.4 256 160.1 268.8 201.7 291.5zM335.9 102C352.8 117.9 397.3 165.4 424.9 244.3C384.8 264.5 349.1 292.5 320 326.4C290.8 292.5 255.2 264.6 215.1 244.3C242.7 165.4 287.3 117.9 304.1 102C308.4 97.9 314.1 96 320 96C325.9 96 331.6 98 335.9 102z'/></svg>">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cardo:ital,wght@0,400;0,700;1,400&family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&family=Inconsolata:wght@200..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg-color: #000000;
            --primary-color: #feeed5ff;
            --accent-color: #f6732fff;
            --border-color: #fff7ccff;
            --hover-color: #333333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Inconsolata", monospace;
        }

body {
    background-color: var(--primary-color);
    border: 10px solid var(--accent-color);
    box-shadow: inset 0 0 0 2px #333; /* Borde interno sólido de 2px */
    color: var(--accent-color);
    line-height: 1.4;
    min-height: 100dvh;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
}

        main {
            max-width: 1200px;
            margin: 0 auto;
        }

        .section {
            display: none;
        }
        .content {
            padding: 20px;

        }

        .section.active {
            display: block;
        }

        .tag-filters {
            display: flex;
            justify-content: center;
            padding-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 8px;
            padding-bottom: 10px;
        }

        .tag-btn {
            background: var(--primary-color);
            border: 2px solid #333;
            color: #333;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .tag-btn.active {
            background: #f8dc3dff;
            color: #333;
        }

        .tag-btn:hover {
            background: var(--accent-color);
            color: var(--primary-color);
        }

        .study-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; /* ← AGREGAR ESTA LÍNEA */
            gap: 20px;
            width: 100%; /* ← AGREGAR ESTA LÍNEA */
            margin: 0 auto; /* ← AGREGAR ESTA LÍNEA */
        }

        .card {
            border: 4px solid var(--border-color);
            width: 100%;
            max-width: 500px;
            background: var(--primary-color);
            margin: 0 auto; /* ← AGREGAR ESTA LÍNEA PARA CENTRAR EL CARD */
        }

        .card-header {
            background: #f8dc3dff;
            color: #333;
            padding: 15px;
            text-align: center;
            border-bottom: 2px solid #333;
        }

        .card-body {
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .card-image {
            max-width: 100%;
            height: 250px;
            object-fit: contain;
            filter: hue-rotate(170deg);
            background-color: transparent;
        }

        .card-details {
            width: 100%;
        }

        .detail-row {
            display: flex;
            margin-bottom: 8px;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
        }

        .detail-label {
            font-weight: bold;
            width: 120px;
            flex-shrink: 0;
            text-transform: uppercase;
            font-size: 0.9rem;
            color: #333;
        }

        .circular-controls {
            display: flex;
            justify-content: center;
            gap: 30px;
            width: 100%;
        }

        .circular-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--accent-color);
            border: 1px solid #333;
            color: #333;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .circular-btn:hover {
            background: #f8dc3dff;
            color: var(--accent-color);
            transform: scale(1.1);
        }

        .list-container {
            display: block;
            max-width: 500px;
            margin: 0 auto;
        }

        .list-item {
            border: 2px solid #333;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 15px;
            box-shadow: 6px 6px 5px rgba(246, 115, 47, 0.3);
        }

        .list-item:last-child {
            margin-bottom: 0;
        }

        .list-item:hover {
            background: #f8dc3d40;
            color: var(--primary-color);
        }

        .list-item h3 {
            background-color: #f8dc3dff;
            color: #333;
            padding: 10px;
            border-bottom: 2px solid #333;
            margin-bottom: 8px;
            text-transform: uppercase;
            font-size: 1.1rem;
        }

        .list-item p {
            padding: 10px;
            font-size: 0.9rem;
        }

        .list-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin: 10px;
            justify-content: center;
        }

        .tag {
            background: #f6442f40;
            border: 1px solid #333;
            color: #333;
            padding: 3px 8px;
            font-size: 0.9rem;
            text-transform: lowercase;
        }

        .search-box {
            max-width: 500px;
            width: 100%;
            padding: 12px;
            border: 2px solid #333;
            background: var(--primary-color);
            color: var(--accent-color);
            margin: 8px auto 10px auto;
            font-size: 1rem;
            display: block;
            text-align: center;
            text-transform: uppercase;
        }

        /* Nuevos estilos para secciones Vinyāsa y Aṣṭāṅga */
        .series-section {
            margin-bottom: 30px;
        }

        .series-title {
            background: #f6442fff;
            color: var(--primary-color);
            padding: 15px;
            text-align: center;
            border: 2px solid #333;
            margin: 15px 0;
            text-transform: uppercase;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .sequence-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .sequence-item {
            border: 2px solid #333;
            padding: 15px;
            background: var(--primary-color);
            cursor: pointer;
            transition: all 0.2s;
            min-width: 200px;
            text-align: center;
        }

        .sequence-item:hover {
            background: #f8dc3d40;
        }

        .sequence-item.active {
            background: var(--accent-color);
            color: var(--primary-color);
        }

        .loading {
            text-align: center;
            padding: 30px;
            font-size: 1.2rem;
            border: 2px solid var(--border-color);
            margin: 20px 0;
        }

        .error {
            background: #330000;
            color: #ff6666;
            padding: 15px;
            border: 2px solid #ff0000;
            margin-bottom: 20px;
            text-transform: uppercase;
            font-weight: bold;
        }

        .stats {
            background: #111111;
            padding: 10px;
            border: 2px solid var(--border-color);
            margin-top: 20px;
            text-align: center;
            font-size: 0.9rem;
            text-transform: uppercase;
        }

        .brutalist-border {
            border: 2px solid #333;
            box-shadow: 6px 6px 5px rgba(246, 115, 47, 0.3);
        }

        .brutalist-btn {
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }

        .brutalist-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .brutalist-btn:hover::after {
            left: 100%;
        }

        /* Estilos para el menú hamburguesa flotante */
        .floating-menu {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
        }

        .burger-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--accent-color);
            border: 3px solid #333;
            color: var(--primary-color);
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            box-shadow: 4px 4px 0px rgba(0, 0, 0, 0.2);
        }

        .burger-btn:hover {
            background: #f8dc3dff;
            color: #333;
            transform: scale(1.05);
        }

        .menu-content {
            position: absolute;
            bottom: 70px;
            left: 0;
            background: var(--primary-color);
            border: 3px solid #333;
            padding: 15px;
            min-width: 250px;
            display: none;
            box-shadow: 6px 6px 0px rgba(0, 0, 0, 0.2);
        }

        .menu-content.active {
            display: block;
        }

        .menu-nav {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin-bottom: 15px;
        }

        .menu-nav-btn {
            background: var(--primary-color);
            border: 2px solid #333;
            color: #333;
            padding: 12px 15px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            text-align: left;
        }

        .menu-nav-btn.active {
            background: var(--accent-color);
            color: var(--primary-color);
        }

        .menu-nav-btn:hover {
            background: #f8dc3dff;
            color: #333;
        }

        .menu-tag-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .menu-tag-btn {
            background: var(--primary-color);
            border: 2px solid #333;
            color: #333;
            padding: 8px 12px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.8rem;
            transition: all 0.2s;
            flex: 1;
            min-width: calc(50% - 5px);
        }

        .menu-tag-btn.active {
            background: #f8dc3dff;
            color: #333;
        }

        .menu-tag-btn:hover {
            background: var(--accent-color);
            color: var(--primary-color);
        }

        /* Estilos para enlaces de asanas */
        .asana-link {
            color: #2f49f6ff;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.2s;
        }

        .asana-link:hover {
            text-decoration: #2f49f660;
        }

        /* Estilos para listas unificadas */
        .unified-list-container {
            max-width: 500px;
            margin: 0 auto;
        }

        .unified-list-item {
            border: 2px solid #333;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 15px;
            box-shadow: 6px 6px 5px rgba(246, 115, 47, 0.3);
        }

        .unified-list-item:last-child {
            margin-bottom: 0;
        }

        .unified-list-item:hover {
            background: #f8dc3d40;
        }

        .unified-list-header {
            background-color: #f8dc3dff;
            color: #333;
            padding: 10px;
            border-bottom: 2px solid #333;
            margin-bottom: 8px;
            text-transform: uppercase;
            font-size: 1.1rem;
        }

        .unified-list-image {
            max-width: 100%;
            height: 200px;
            object-fit: contain;
            filter: hue-rotate(170deg);
            background-color: transparent;
            display: block;
            margin: 0 auto 10px auto;
        }

        .unified-list-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin: 5px 0 5px 0;

        }

        .unified-list-details {
            padding: 10px;
            font-size: 0.9rem;
        }

        /* Ajuste para nombres largos en móviles */
        .card-header h2 {
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        @media (max-width: 768px) {
            .list-container {
                grid-template-columns: 1fr;
            }
            
            .circular-controls {
                gap: 20px;
            }
            
            .sequence-container {
                flex-direction: column;
                align-items: center;
            }
            
            .sequence-item {
                width: 100%;
                max-width: 300px;
            }
            
            .menu-content {
                min-width: 200px;
            }
            
            /* Ajuste de tamaño de fuente para nombres largos */
            .card-header h2 {
                font-size: clamp(0.9rem, 4vw, 1.5rem);
            }
        }

        @media (min-width: 1024px) {
            .study-container {
                flex-direction: row;
                align-items: flex-start;
                gap: 40px;
                max-width: 1000px;
                margin: 0 auto;
            }
            
            .card {
                max-width: 600px;
                flex: 1;
            }
            
            .image-column {
                flex: 1;
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 20px;
            }
            
            .card-image {
                height: 400px;
                max-width: 100%;
            }
        }

        /* ESTILOS PARA AJUSTAR TEXTO LARGO EN CAMPOS DEL CARD */
.card-header h2 {
    max-width: 100%;
    word-wrap: break-word;
    overflow-wrap: break-word;
    hyphens: auto;
    line-height: 1.2;
    text-align: center;
}

.detail-row span:not(.detail-label) {
    max-width: 100%;
    word-wrap: break-word;
    overflow-wrap: break-word;
    hyphens: auto;
    line-height: 1.3;
    flex: 1;
    min-width: 0;
}

/* Permitir múltiples líneas en todos los campos */
.detail-row {
    display: flex;
    flex-wrap: nowrap;
    align-items: flex-start;
    min-height: auto;
    padding-bottom: 8px;
}

.detail-label {
    flex-shrink: 0;
    width: 120px;
    margin-right: 10px;
}

/* Ajuste de tamaño de fuente progresivo para textos largos */
.card-header h2 {
    font-size: clamp(1rem, 4vw, 1.8rem);
}

.detail-row span:not(.detail-label) {
    font-size: clamp(0.8rem, 2.5vw, 1rem);
}

/* Para enlaces de asanas - mantener intactos pero permitir wrap */
.asana-link {
    word-wrap: break-word;
    overflow-wrap: break-word;
    hyphens: auto;
    white-space: normal;
    display: inline;
}

/* Ajustes específicos para móviles */
@media (max-width: 768px) {
    .card-header h2 {
        font-size: clamp(0.9rem, 3.5vw, 1.5rem);
        padding: 12px 8px;
    }
    
    .detail-row {
        flex-direction: row;
        align-items: flex-start;
    }
    
    .detail-label {
        width: 100px;
        font-size: 0.8rem;
    }
    
    .detail-row span:not(.detail-label) {
        font-size: clamp(0.75rem, 2vw, 0.9rem);
    }
}

/* Para pantallas muy pequeñas */
@media (max-width: 480px) {
    .card-header h2 {
        font-size: clamp(0.8rem, 4vw, 1.2rem);
        line-height: 1.1;
    }
    
    .detail-row {
        flex-direction: row;
        margin-bottom: 10px;
    }
    
    .detail-label {
        width: 90px;
        font-size: 0.75rem;
    }
    
    .detail-row span:not(.detail-label) {
        font-size: 0.75rem;
        line-height: 1.2;
    }
}

/* Estilos para el toggle de detalles */
.details-toggle {
    background: var(--accent-color);
    color: var(--primary-color);
    border: 2px solid #333;
    padding: 8px 15px;
    cursor: pointer;
    font-weight: bold;
    text-transform: uppercase;
    font-size: 0.9rem;
    margin: 10px 0;
    transition: all 0.3s;
    width: 100%;
    text-align: center;
}

.details-toggle:hover {
    background: #f8dc3dff;
    color: #333;
}

.details-content {
    display: none;
    width: 100%;
    animation: fadeIn 0.3s ease-in;
}

.details-content.expanded {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

/* Ajustes para el layout básico */
.basic-details {
    width: 100%;
}

/* AGREGAR estos estilos al final del CSS existente */

/* Estilos para los controles de secuencia Aṣṭāṅga */
#ashtanga-sequence-controls {
    margin-top: 10px;
    gap: 15px;
    align-items: center;
}

#ashtanga-sequence-controls span {
    font-family: "Inconsolata", monospace;
    text-transform: uppercase;
    font-size: 0.8rem;
    letter-spacing: 1px;
}

#ashtanga-prev-btn, #ashtanga-next-btn {
    background: #f6442fff;
    border: 2px solid #333;
    color: var(--primary-color);
    font-weight: bold;
    transition: all 0.3s;
}

#ashtanga-prev-btn:hover, #ashtanga-next-btn:hover {
    background: #f8dc3dff;
    color: #333;
    transform: scale(1.1);
}

/* Ajuste responsive para móviles */
@media (max-width: 768px) {
    #ashtanga-sequence-controls {
        gap: 10px;
    }
    
    #ashtanga-sequence-controls span {
        font-size: 0.7rem;
    }
}


:root {
    --bg-color: #000000;
    --primary-color: #feeed5ff;
    --accent-color: #f6732fff;
    --border-color: #fff7ccff;
    --hover-color: #333333;
    
    /* Nuevas paletas de color para secciones específicas */
    --vinyasa-primary: #e8f4f8;
    --vinyasa-accent: #2a9d8f;
    --vinyasa-border: #264653;
    
    --ashtanga-primary: #fefae0;
    --ashtanga-accent: #e76f51;
    --ashtanga-border: #2a9d8f;
    
    --niskriya-primary: #f8edeb;
    --niskriya-accent: #a8dadc;
    --niskriya-border: #457b9d;
}

/* Estilos específicos para cada sección */
body.vinyasa-section {
    background-color: var(--vinyasa-primary);
    border: 10px solid var(--vinyasa-accent);
    box-shadow: inset 0 0 0 2px var(--vinyasa-border);
}

body.ashtanga-section {
    background-color: var(--ashtanga-primary);
    border: 10px solid var(--ashtanga-accent);
    box-shadow: inset 0 0 0 2px var(--ashtanga-border);
}

body.niskriya-section {
    background-color: var(--niskriya-primary);
    border: 10px solid var(--niskriya-accent);
    box-shadow: inset 0 0 0 2px var(--niskriya-border);
}

/* Botones específicos para cada sección */
.vinyasa-section .circular-btn {
    background: var(--vinyasa-accent);
    border: 1px solid var(--vinyasa-border);
}

.ashtanga-section .circular-btn {
    background: var(--ashtanga-accent);
    border: 1px solid var(--ashtanga-border);
}

.niskriya-section .circular-btn {
    background: var(--niskriya-accent);
    border: 1px solid var(--niskriya-border);
}

/* Headers específicos para cada sección */
.vinyasa-section .card-header {
    background: var(--vinyasa-accent);
    border-bottom: 2px solid var(--vinyasa-border);
}

.ashtanga-section .card-header {
    background: var(--ashtanga-accent);
    border-bottom: 2px solid var(--ashtanga-border);
}

.niskriya-section .card-header {
    background: var(--niskriya-accent);
    border-bottom: 2px solid var(--niskriya-border);
}

.content {
    padding: 20px;
    min-height: 90dvh;
    display: flex;
    align-items: center;
    justify-content: center;
}

.study-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 20px;
    width: 100%;
    margin: 0 auto;
}

.card {
    border: 4px solid var(--border-color);
    width: 100%;
    max-width: 500px;
    background: var(--primary-color);
    margin: 0 auto;
}

/* Ajustar altura mínima del body */
body {
    background-color: var(--primary-color);
    border: 10px solid var(--accent-color);
    box-shadow: inset 0 0 0 2px #333;
    color: var(--accent-color);
    line-height: 1.4;
    min-height: 100dvh;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
}

/* Estilos para el menú de filtros flotante */
.floating-filters {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 1000;
}

.filter-btn {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: var(--accent-color);
    border: 3px solid #333;
    color: var(--primary-color);
    font-size: 24px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
    box-shadow: 4px 4px 0px rgba(0, 0, 0, 0.2);
}

.filter-btn:hover {
    background: #f8dc3dff;
    color: #333;
    transform: scale(1.05);
}

.filter-content {
    position: absolute;
    bottom: 70px;
    right: 0;
    background: var(--primary-color);
    border: 3px solid #333;
    padding: 15px;
    min-width: 200px;
    display: none;
    box-shadow: 6px 6px 0px rgba(0, 0, 0, 0.2);
}

.filter-content.active {
    display: block;
}

.filter-title {
    background: var(--accent-color);
    color: var(--primary-color);
    padding: 10px;
    text-align: center;
    border: 2px solid #333;
    margin-bottom: 10px;
    text-transform: uppercase;
    font-weight: bold;
    font-size: 0.9rem;
}

/* Ocultar filtros cuando no esté en la sección japāsana */
body:not(.study-section) .floating-filters {
    display: none;
}

/* Mostrar filtros solo en la sección japāsana */
body.study-section .floating-filters {
    display: block;
}
/* Estilos específicos para la sección study */
body.study-section {
    background-color: var(--primary-color);
    border: 10px solid var(--accent-color);
    box-shadow: inset 0 0 0 2px var(--border-color);
}

.study-section .circular-btn {
    background: var(--accent-color);
    border: 1px solid var(--border-color);
}

.study-section .card-header {
    background: var(--accent-color);
}

/* CORRECCIÓN: Asegurar que todos los cards tengan el mismo tamaño */
.study-container .card,
#vinyasa .card,
#ashtanga .card,
#niskriya .card,
#lexicon .card {
    width: 90dvw;
    max-width: 500px;
    margin: 0 auto;
    border: 4px solid #333;
    background: var(--primary-color);
}

/* Asegurar que el contenedor de estudio mantenga el mismo layout */
.study-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 20px;
    width: 100%;
    margin: 0 auto;
}

/* Para pantallas grandes, mantener consistencia */
@media (min-width: 1024px) {
    .study-container .card,
    #vinyasa .card,
    #ashtanga .card,
    #niskriya .card,
    #lexicon .card {
        width: 500px; /* Mismo tamaño máximo para todos */
    }
}

/* Asegurar que la presencia del filter menu no afecte el tamaño del card */
.floating-filters {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 1000;
}

/* El filter menu NO debe afectar el layout del card */
body.study-section .study-container {
    width: 100%;
    max-width: none; /* Quitar cualquier max-width que pueda estar causando el problema */
}

/* Nuevas paletas de color para léxico */
:root {
    /* ... colores existentes ... */
    
    /* Paletas verdes para léxico */
    --lexicon-primary: #f0f7ee;
    --lexicon-accent: #4a7c59;
    --lexicon-border: #2d4a3a;
    
    --lexicon-dark-primary: #e8f5e8;
    --lexicon-dark-accent: #3a6b4a;
    --lexicon-dark-border: #1e3528;
    
    /* Paleta rosa para Sobre Mí */
    --about-primary: #fdf2f8;
    --about-accent: #ec4899;
    --about-border: #be185d;
}

/* Estilos específicos para secciones de léxico */
body.lexicon-section {
    background-color: var(--lexicon-primary);
    border: 10px solid var(--lexicon-accent);
    box-shadow: inset 0 0 0 2px var(--lexicon-border);
}

body.lexicon-list-section {
    background-color: var(--lexicon-dark-primary);
    border: 10px solid var(--lexicon-dark-accent);
    box-shadow: inset 0 0 0 2px var(--lexicon-dark-border);
}

/* Estilos específicos para Sobre Mí */
body.about-section {
    background-color: var(--about-primary);
    border: 10px solid var(--about-accent);
    box-shadow: inset 0 0 0 2px var(--about-border);
}

/* Botones específicos para léxico */
.lexicon-section .circular-btn,
.lexicon-list-section .circular-btn {
    background: var(--lexicon-accent);
    border: 1px solid var(--lexicon-border);
}

.about-section .circular-btn {
    background: var(--about-accent);
    border: 1px solid var(--about-border);
}

/* Headers específicos para léxico */
.lexicon-section .card-header,
.lexicon-list-section .card-header {
    background: var(--lexicon-accent);
    border-bottom: 2px solid var(--lexicon-border);
}

.about-section .card-header {
    background: var(--about-accent);
    border-bottom: 2px solid var(--about-border);
}

/* Asegurar que los cards de léxico tengan el mismo tamaño */
#lexicon .card,
#lexicon-list .card,
#about .card {
    width: 90dvw;
    max-width: 500px;
    margin: 0 auto;
    border: 4px solid #333;
    background: var(--primary-color);
}

/* Para pantallas grandes, mantener consistencia */
@media (min-width: 1024px) {
    #lexicon .card,
    #lexicon-list .card,
    #about .card {
        width: 500px;
    }
}

:root {
    /* ... otras variables ... */
    
    /* Filtros por sección */
    --study-hue: 170deg;
    --vinyasa-hue: 220deg;
    --ashtanga-hue: 300deg;
    --niskriya-hue: 60deg;
    --lexicon-hue: 120deg;
    --lexicon-list-hue: 120deg;
    --about-hue: 320deg;
}

.study-section .card-image {
    filter: hue-rotate(var(--study-hue));
}

.vinyasa-section .card-image {
    filter: hue-rotate(var(--vinyasa-hue));
}

.ashtanga-section .card-image {
    filter: hue-rotate(var(--ashtanga-hue));
}

.niskriya-section .card-image {
    filter: hue-rotate(var(--niskriya-hue));
}

.lexicon-section .card-image,
.lexicon-list-section .card-image {
    filter: hue-rotate(var(--lexicon-hue));
}

.about-section .card-image {
    filter: hue-rotate(var(--about-hue));
}

    </style>
</head>

<body>
    <div class="content">
    <main>
<section id="study" class="section active">
    <div class="study-container">
        <div class="card brutalist-border">
            <div class="card-header">
                <h2 id="card-title" class="brutalist-text">SELECT ASANA</h2>
            </div>
            <div class="card-body">
                <img id="card-image" src="" alt="Asana" class="card-image" style="display: none;">
                <div class="card-details" id="card-details">
                    <p>USE FILTERS AND NAVIGATION TO EXPLORE ASANAS</p>
                </div>
                <div class="circular-controls">
                    <button class="circular-btn brutalist-btn" id="prev-btn">‹</button>
                        <span style="color: #333; font-weight: bold; font-size: 0.8rem;">RANDOM</span>
                    <button class="circular-btn brutalist-btn" id="next-btn">›</button>
                </div>

    </div>
</section>
        
<section id="vinyasa" class="section">
    <div class="study-container">
        <div class="card brutalist-border">
            <div class="card-header">
                <h2 id="vinyasa-title" class="brutalist-text">SELECT VINYĀSA ASANA</h2>
            </div>
            <div class="card-body">
                <img id="vinyasa-image" src="" alt="Vinyāsa Asana" class="card-image" style="display: none;">
                <div class="card-details" id="vinyasa-details">
                    <p>USE NAVIGATION TO EXPLORE VINYĀSA ASANAS</p>
                </div>
                <div class="circular-controls">
                    <button class="circular-btn brutalist-btn" id="vinyasa-prev-btn">‹</button>
                    <span style="color: #333; font-weight: bold; font-size: 0.8rem;">VINYĀSA</span>
                    <button class="circular-btn brutalist-btn" id="vinyasa-next-btn">›</button>
                </div>
            </div>
        </div>
    </div>
</section>

<section id="ashtanga" class="section">
    <div class="study-container">
        <div class="card brutalist-border">
            <div class="card-header">
                <h2 id="ashtanga-title" class="brutalist-text">SELECT AṢṬĀṄGA ASANA</h2>
            </div>
            <div class="card-body">
                <img id="ashtanga-image" src="" alt="Aṣṭāṅga Asana" class="card-image" style="display: none;">
                <div class="card-details" id="ashtanga-details">
                    <p>USE NAVIGATION TO EXPLORE AṢṬĀṄGA ASANAS</p>
                </div>
                <div class="circular-controls">
                    <button class="circular-btn brutalist-btn" id="ashtanga-prev-btn">‹</button>
                    <span style="color: #333; font-weight: bold; font-size: 0.8rem;">AṢṬĀṄGA</span>
                    <button class="circular-btn brutalist-btn" id="ashtanga-next-btn">›</button>
                </div>
            </div>
        </div>
    </div>
</section>

<section id="niskriya" class="section">
    <div class="study-container">
        <div class="card brutalist-border">
            <div class="card-header">
                <h2 id="niskriya-title" class="brutalist-text">SELECT NIṢKRIYA ASANA</h2>
            </div>
            <div class="card-body">
                <img id="niskriya-image" src="" alt="Niṣkriya Asana" class="card-image" style="display: none;">
                <div class="card-details" id="niskriya-details">
                    <p>USE NAVIGATION TO EXPLORE NIṢKRIYA ASANAS</p>
                </div>
                <div class="circular-controls">
                    <button class="circular-btn brutalist-btn" id="niskriya-prev-btn">‹</button>
                    <span style="color: #333; font-weight: bold; font-size: 0.8rem;">NIṢKRIYA</span>
                    <button class="circular-btn brutalist-btn" id="niskriya-next-btn">›</button>
                </div>
            </div>
        </div>
    </div>
</section>
        
        <section id="list" class="section">
            <input type="text" id="search" class="search-box" placeholder="buscador de āsanas">
            <div class="list-container" id="list-container">
                <p>USE SEARCH BOX TO FIND ASANAS</p>
            </div>
        </section>

        
<section id="lexicon" class="section">
    <div class="study-container">
        <div class="card brutalist-border">
            <div class="card-header">
                <h2 id="lexicon-title" class="brutalist-text">SELECT TERM</h2>
            </div>
            <div class="card-body">
                <div class="card-details" id="lexicon-details">
                    <p>USE NAVIGATION TO EXPLORE TERMS</p>
                </div>
                <div class="circular-controls">
                    <button class="circular-btn brutalist-btn" id="lexicon-prev-btn">‹</button>
                    <button class="circular-btn brutalist-btn" id="lexicon-next-btn">›</button>
                </div>
                <!-- QUITAR los controles Aṣṭāṅga de aquí -->
            </div>
        </div>
    </div>
</section>

<section id="lexicon-list" class="section">
    <input type="text" id="lexicon-search" class="search-box" placeholder="buscador de términos">
    <div class="list-container" id="lexicon-list-container">
        <p>USE SEARCH BOX TO FIND TERMS</p>
    </div>
</section>

<!-- Agregar esta sección después de la sección lexicon-list -->
<section id="about" class="section">
    <div class="study-container">
        <div class="card brutalist-border">
            <div class="card-header">
                <h2 id="about-title" class="brutalist-text">Hello! My name is Mica</h2>
            </div>
            <div class="card-body">
                <div class="card-details" id="about-details">
                    <div class="detail-row">
                        <span class="detail-label">EMAIL:</span>
                        <span>tu.email@ejemplo.com</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">GITHUB:</span>
                        <span><a href="https://github.com/tuusuario" class="asana-link" target="_blank">github.com/tuusuario</a></span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">INFORMATION:</span>
                        <span>Desarrollador web apasionado por el yoga y la tecnología</span>
                    </div>
                </div>
                <div class="circular-controls">
                    <!-- Puedes agregar controles aquí si lo deseas -->
                    <span style="color: #333; font-weight: bold; font-size: 0.8rem;">ABOUT ME</span>
                </div>
            </div>
        </div>
    </div>
</section>



        <div id="loading" class="loading brutalist-border" style="display: none;">LOADING ASANA DATA...</div>
        <div id="error" class="error brutalist-border" style="display: none;"></div>
    </main>
    
    <!-- Menú hamburguesa flotante -->
    <div class="floating-menu">
        <button class="burger-btn brutalist-btn" id="burger-btn">
            <i class="fas fa-bars"></i>
        </button>
        <div class="menu-content brutalist-border" id="menu-content">
            <div class="menu-nav">
                <button class="menu-nav-btn active brutalist-btn" data-section="study">japāsana</button>
                <button class="menu-nav-btn brutalist-btn" data-section="vinyasa">vinyāsa</button>
                <button class="menu-nav-btn brutalist-btn" data-section="ashtanga">aṣṭāṅga</button>
                <button class="menu-nav-btn brutalist-btn" data-section="niskriya">niṣkriya</button>
                <button class="menu-nav-btn brutalist-btn" data-section="list">saṅgraha</button>
                <button class="menu-nav-btn brutalist-btn" data-section="lexicon">śabda</button>
                <button class="menu-nav-btn brutalist-btn" data-section="lexicon-list">kośa</button>
                <button class="menu-nav-btn brutalist-btn" data-section="about">sobre mí</button>

            </div>
            <!-- QUITAR los filtros de aquí -->
        </div>
    </div>

    <!-- Menú de filtros flotante en la parte inferior derecha -->
    <div class="floating-filters">
        <button class="filter-btn brutalist-btn" id="filter-btn">
            <i class="fa-solid fa-filter"></i>
        </button>
        <div class="filter-content brutalist-border" id="filter-content">
            <div class="filter-title">FILTROS</div>
            <div class="menu-tag-filters" id="menu-tag-filters">
                <!-- Tag buttons will be generated here -->
            </div>
        </div>
    </div>
</div>

<script>
    // Global variables
    let asanaData = [];
    let filteredAsanas = [];
    let currentAsanaIndex = 0;
    let activeTags = new Set();
    let allTags = [];


    // Agregar variables globales para el léxico
    let lexiconData = [];
    let filteredLexicon = [];
    let currentLexiconIndex = 0;

    // AGREGAR elementos DOM para controles Aṣṭāṅga (asegúrate de que estén en el scope global)

    // Variables globales para las nuevas secciones
    let vinyasaAsanas = [];
    let currentVinyasaIndex = 0;
    let ashtangaAsanas = [];
    let currentAshtangaIndex = 0;
    let niskriyaAsanas = [];
    let currentNiskriyaIndex = 0;

    // Elementos DOM para las nuevas secciones
    const vinyasaTitle = document.getElementById('vinyasa-title');
    const vinyasaImage = document.getElementById('vinyasa-image');
    const vinyasaDetails = document.getElementById('vinyasa-details');
    const vinyasaPrevBtn = document.getElementById('vinyasa-prev-btn');
    const vinyasaNextBtn = document.getElementById('vinyasa-next-btn');

    const ashtangaTitle = document.getElementById('ashtanga-title');
    const ashtangaImage = document.getElementById('ashtanga-image');
    const ashtangaDetails = document.getElementById('ashtanga-details');
    const ashtangaPrevBtn = document.getElementById('ashtanga-prev-btn');
    const ashtangaNextBtn = document.getElementById('ashtanga-next-btn');

    const niskriyaTitle = document.getElementById('niskriya-title');
    const niskriyaImage = document.getElementById('niskriya-image');
    const niskriyaDetails = document.getElementById('niskriya-details');
    const niskriyaPrevBtn = document.getElementById('niskriya-prev-btn');
    const niskriyaNextBtn = document.getElementById('niskriya-next-btn');

    // Agregar elementos DOM del léxico
    const lexiconSection = document.getElementById('lexicon');
    const lexiconListSection = document.getElementById('lexicon-list');
    const lexiconTitle = document.getElementById('lexicon-title');
    const lexiconDetails = document.getElementById('lexicon-details');
    const lexiconPrevBtn = document.getElementById('lexicon-prev-btn');
    const lexiconNextBtn = document.getElementById('lexicon-next-btn');
    const lexiconSearchBox = document.getElementById('lexicon-search');
    const lexiconListContainer = document.getElementById('lexicon-list-container');

// Filter elements
const filterBtn = document.getElementById('filter-btn');
const filterContent = document.getElementById('filter-content');

    // Función para cargar el léxico CSV
    async function loadLexiconData() {
        try {
            const response = await fetch('lexicon.csv');
            if (!response.ok) throw new Error('Lexicon CSV file not found');
            
            const csvText = await response.text();
            
            return new Promise((resolve, reject) => {
                Papa.parse(csvText, {
                    header: true,
                    skipEmptyLines: true,
                    complete: function(results) {
                        if (results.errors.length > 0) {
                            reject(new Error(results.errors[0].message));
                            return;
                        }
                        
                        lexiconData = results.data.map(row => {
                            const cleanRow = {};
                            for (const key in row) {
                                cleanRow[key] = row[key] ? row[key].trim() : '';
                            }
                            return cleanRow;
                        });
                        
                        resolve(lexiconData);
                    },
                    error: function(error) {
                        reject(new Error(`Failed to parse lexicon CSV: ${error.message}`));
                    }
                });
            });
        } catch (error) {
            throw error;
        }
    }

    // Renderizar tarjeta del término actual
    function renderLexiconCard() {
        if (filteredLexicon.length === 0) {
            lexiconTitle.textContent = "NO TERMS MATCH FILTERS";
            lexiconDetails.innerHTML = "<p>ADJUST FILTERS TO SEE TERMS</p>";
            return;
        }
        
        const term = filteredLexicon[currentLexiconIndex];
        
        lexiconTitle.textContent = term.term ? term.term.toUpperCase() : 'NO TERM';
        
        let detailsHTML = '';
        
        if (term.devanāgarī && term.devanāgarī.trim() !== '') {
            detailsHTML += `
                <div class="detail-row">
                    <span class="detail-label">DEVANAGARI:</span>
                    <span style="font-size: 1.5rem; font-weight: bold;">${term.devanāgarī}</span>
                </div>`;
        }
        
        if (term.meaning && term.meaning.trim() !== '') {
            detailsHTML += `
                <div class="detail-row">
                    <span class="detail-label">MEANING:</span>
                    <span style="font-style: italic;">${term.meaning}</span>
                </div>`;
        }
        
        lexiconDetails.innerHTML = detailsHTML || '<p>NO DETAILS AVAILABLE</p>';
    }

    // Renderizar lista de términos
    function renderLexiconList() {
        lexiconListContainer.innerHTML = '';
        
        if (filteredLexicon.length === 0) {
            lexiconListContainer.innerHTML = '<p>NO TERMS MATCH FILTERS</p>';
            return;
        }
        
        // Ordenar alfabéticamente por término
        const sortedTerms = [...filteredLexicon].sort((a, b) => {
            const termA = (a.term || '').toLowerCase();
            const termB = (b.term || '').toLowerCase();
            return termA.localeCompare(termB);
        });
        
        sortedTerms.forEach(term => {
            const item = document.createElement('div');
            item.className = 'list-item';
            item.addEventListener('click', () => {
                switchSection('lexicon');
                const index = filteredLexicon.findIndex(t => t.term === term.term);
                if (index !== -1) {
                    currentLexiconIndex = index;
                    renderLexiconCard();
                }
            });
            
            let itemHTML = `<h3>${term.term.toUpperCase()}</h3>`;
            
            
            if (term.meaning && term.meaning.trim() !== '') {
                itemHTML += `<p style="font-style: italic; text-align: left; padding-top: 0px">${term.meaning}</p>`;
            }
            
            item.innerHTML = itemHTML;
            lexiconListContainer.appendChild(item);
        });
    }

    // Mapeo de series
    const seriesMapping = {
        'ādhāra': 'ādhāra - <i>foundation</i>',
        'yoga cikitsā': 'yoga cikitsā - <i>primera</i>',
        'nāḍī śodhana': 'nāḍī śodhana - <i>segunda</i>',
        'tṛtīya śreṇī': 'tṛtīya śreṇī - <i>tercera</i>',
        'pṛṣṭhavakrāsana': 'pṛṣṭhavakrāsana - <i>backbends</i>',
        'samāpana': 'samāpana - <i>cierre</i>'
    };

    // Mapeo de SeriesHot
    const seriesHotMapping = {
        'Despertar': 'bodha - <i>awakening</i>',
        'Apertura': 'vikāsa - <i>opening</i>',
        'Vitalidad': 'jīvanaśakti - <i>vitality</i>',
        'Integracion': 'saṃyoga - <i>integration</i>',
        'Equilibrio': 'tulā - <i>balance</i>',
        'Entrega': 'samarpaṇa - <i>surrender</i>',
        'Esfuerzo': 'vīrya - <i>effort</i>',
        'Conexion': 'sambandha - <i>connection</i>'
    };

    // DOM elements
    const studySection = document.getElementById('study');
    const listSection = document.getElementById('list');
    const vinyasaSection = document.getElementById('vinyasa');
    const ashtangaSection = document.getElementById('ashtanga');
    const cardTitle = document.getElementById('card-title');
    const cardImage = document.getElementById('card-image');
    const cardDetails = document.getElementById('card-details');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const searchBox = document.getElementById('search');
    const listContainer = document.getElementById('list-container');
    const vinyasaContainer = document.getElementById('vinyasa-container');
    const ashtangaContainer = document.getElementById('ashtanga-container');
    const loadingElement = document.getElementById('loading');
    const errorElement = document.getElementById('error');
    
    // Menu elements
    const burgerBtn = document.getElementById('burger-btn');
    const menuContent = document.getElementById('menu-content');
    const menuNavButtons = document.querySelectorAll('.menu-nav-btn');
    const menuTagFilters = document.getElementById('menu-tag-filters');

// Función para mejorar la experiencia touch en móviles
function setupTouchImprovements() {
    let touchStartX = 0;
    let touchEndX = 0;
    let lastTouchTime = 0;
    const swipeThreshold = 50; // Mínimo de pixels para considerar un swipe
    const doubleTapThreshold = 300; // Máximo tiempo entre toques para considerar double tap
    
    // Detectar swipe en las secciones de cards
// En setupTouchImprovements, actualiza cardSections:
const cardSections = ['study', 'vinyasa', 'ashtanga', 'niskriya', 'lexicon', 'about'];    
    cardSections.forEach(sectionId => {
        const section = document.getElementById(sectionId);
        if (section) {
            section.addEventListener('touchstart', function(e) {
                touchStartX = e.changedTouches[0].screenX;
                const currentTime = new Date().getTime();
                
                // Prevenir double tap zoom
                if (currentTime - lastTouchTime < doubleTapThreshold) {
                    e.preventDefault();
                }
                lastTouchTime = currentTime;
            }, { passive: false });
            
            section.addEventListener('touchend', function(e) {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe(sectionId);
            }, { passive: true });
        }
    });
    
    function handleSwipe(sectionId) {
        const diff = touchStartX - touchEndX;
        
        // Swipe izquierdo (siguiente)
        if (diff > swipeThreshold) {
            navigateNext(sectionId);
        }
        // Swipe derecho (anterior)
        else if (diff < -swipeThreshold) {
            navigatePrev(sectionId);
        }
    }
    
    function navigateNext(sectionId) {
        switch(sectionId) {
            case 'study':
                if (filteredAsanas.length > 0) {
                    currentAsanaIndex = (currentAsanaIndex + 1) % filteredAsanas.length;
                    renderAsanaCard();
                }
                break;
            case 'vinyasa':
                if (vinyasaAsanas.length > 0) {
                    currentVinyasaIndex = (currentVinyasaIndex + 1) % vinyasaAsanas.length;
                    renderVinyasaCard();
                }
                break;
            case 'ashtanga':
                if (ashtangaAsanas.length > 0) {
                    currentAshtangaIndex = (currentAshtangaIndex + 1) % ashtangaAsanas.length;
                    renderAshtangaCard();
                }
                break;
            case 'niskriya':
                if (niskriyaAsanas.length > 0) {
                    currentNiskriyaIndex = (currentNiskriyaIndex + 1) % niskriyaAsanas.length;
                    renderNiskriyaCard();
                }
                break;
            case 'lexicon':
                if (filteredLexicon.length > 0) {
                    currentLexiconIndex = (currentLexiconIndex + 1) % filteredLexicon.length;
                    renderLexiconCard();
                }
                break;
        }
    }
    
    function navigatePrev(sectionId) {
        switch(sectionId) {
            case 'study':
                if (filteredAsanas.length > 0) {
                    currentAsanaIndex = (currentAsanaIndex - 1 + filteredAsanas.length) % filteredAsanas.length;
                    renderAsanaCard();
                }
                break;
            case 'vinyasa':
                if (vinyasaAsanas.length > 0) {
                    currentVinyasaIndex = (currentVinyasaIndex - 1 + vinyasaAsanas.length) % vinyasaAsanas.length;
                    renderVinyasaCard();
                }
                break;
            case 'ashtanga':
                if (ashtangaAsanas.length > 0) {
                    currentAshtangaIndex = (currentAshtangaIndex - 1 + ashtangaAsanas.length) % ashtangaAsanas.length;
                    renderAshtangaCard();
                }
                break;
            case 'niskriya':
                if (niskriyaAsanas.length > 0) {
                    currentNiskriyaIndex = (currentNiskriyaIndex - 1 + niskriyaAsanas.length) % niskriyaAsanas.length;
                    renderNiskriyaCard();
                }
                break;
            case 'lexicon':
                if (filteredLexicon.length > 0) {
                    currentLexiconIndex = (currentLexiconIndex - 1 + filteredLexicon.length) % filteredLexicon.length;
                    renderLexiconCard();
                }
                break;
        }
    }
    
    // Mejorar los botones para touch
    const buttons = document.querySelectorAll('.circular-btn, .menu-nav-btn, .menu-tag-btn, .filter-btn, .burger-btn');
    buttons.forEach(button => {
        // Agregar feedback táctil mejorado
        button.addEventListener('touchstart', function() {
            this.style.transform = 'scale(0.95)';
            this.style.opacity = '0.8';
        }, { passive: true });
        
        button.addEventListener('touchend', function() {
            this.style.transform = 'scale(1)';
            this.style.opacity = '1';
        }, { passive: true });
        
        button.addEventListener('touchcancel', function() {
            this.style.transform = 'scale(1)';
            this.style.opacity = '1';
        }, { passive: true });
    });
    
    // Mejorar los items de lista para touch
    const listItems = document.querySelectorAll('.list-item, .unified-list-item');
    listItems.forEach(item => {
        item.style.cursor = 'pointer';
        item.addEventListener('touchstart', function() {
            this.style.backgroundColor = '#f8dc3d40';
            this.style.transform = 'scale(0.98)';
        }, { passive: true });
        
        item.addEventListener('touchend', function() {
            this.style.backgroundColor = '';
            this.style.transform = 'scale(1)';
        }, { passive: true });
        
        item.addEventListener('touchcancel', function() {
            this.style.backgroundColor = '';
            this.style.transform = 'scale(1)';
        }, { passive: true });
    });
    
    // Prevenir scroll no deseado en elementos interactivos
    const interactiveElements = document.querySelectorAll('.circular-controls, .menu-content, .filter-content');
    interactiveElements.forEach(element => {
        element.addEventListener('touchmove', function(e) {
            e.preventDefault();
        }, { passive: false });
    });
    
    console.log('Mejoras touch inicializadas correctamente');
}
    
    // Función para mezclar array aleatoriamente
    function shuffleArray(array) {
        const shuffled = [...array];
        for (let i = shuffled.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }
        return shuffled;
    }

    // Función para construir secuencias basadas en relaciones Before/After
    function buildSequenceFromRelations(asanas, seriesName) {
        console.log(`Construyendo secuencia para: ${seriesName}`);
        
        // Crear un mapa para búsqueda rápida por nombre
        const asanaMap = new Map();
        asanas.forEach(asana => {
            asanaMap.set(asana.Name.toUpperCase(), asana);
            if (asana.Sandhi) {
                asanaMap.set(asana.Sandhi.toUpperCase(), asana);
            }
        });
        
        // Encontrar la primera āsana (sin referencia "Before")
        let firstAsana = null;
        for (const asana of asanas) {
            // Si no tiene "Before" o su "Before" no está en esta serie
            if (!asana.Before || asana.Before.trim() === '') {
                firstAsana = asana;
                break;
            }
            
            const beforeAsana = asanaMap.get(asana.Before.toUpperCase());
            if (!beforeAsana || !asanas.includes(beforeAsana)) {
                firstAsana = asana;
                break;
            }
        }
        
        // Si no encontramos una primera āsana clara, usar la primera del array
        if (!firstAsana && asanas.length > 0) {
            firstAsana = asanas[0];
        }
        
        if (!firstAsana) {
            console.log(`No se pudo determinar la primera āsana para ${seriesName}`);
            return [...asanas].sort((a, b) => {
                const nameA = (a.Sandhi || a.Name).toLowerCase();
                const nameB = (b.Sandhi || b.Name).toLowerCase();
                return nameA.localeCompare(nameB);
            });
        }
        
        // Construir la secuencia
        const sequence = [firstAsana];
        const usedAsanas = new Set([firstAsana.Name]);
        
        let currentAsana = firstAsana;
        let iterations = 0;
        const maxIterations = asanas.length * 2; // Prevenir bucles infinitos
        
        while (sequence.length < asanas.length && iterations < maxIterations) {
            iterations++;
            
            // Buscar la siguiente āsana usando la relación "After"
            if (currentAsana.After && currentAsana.After.trim() !== '') {
                const nextAsana = asanaMap.get(currentAsana.After.toUpperCase());
                
                if (nextAsana && 
                    asanas.includes(nextAsana) && 
                    !usedAsanas.has(nextAsana.Name)) {
                    
                    sequence.push(nextAsana);
                    usedAsanas.add(nextAsana.Name);
                    currentAsana = nextAsana;
                    continue;
                }
            }
            
            // Si no hay relación "After" o ya usamos esa āsana,
            // buscar cualquier āsana no usada que tenga "Before" apuntando a la actual
            let foundNext = false;
            for (const asana of asanas) {
                if (!usedAsanas.has(asana.Name) && 
                    asana.Before && 
                    asana.Before.trim() !== '') {
                    
                    const beforeAsana = asanaMap.get(asana.Before.toUpperCase());
                    if (beforeAsana === currentAsana) {
                        sequence.push(asana);
                        usedAsanas.add(asana.Name);
                        currentAsana = asana;
                        foundNext = true;
                        break;
                    }
                }
            }
            
            if (foundNext) continue;
            
            // Si no encontramos por relaciones, agregar cualquier āsana no usada
            for (const asana of asanas) {
                if (!usedAsanas.has(asana.Name)) {
                    sequence.push(asana);
                    usedAsanas.add(asana.Name);
                    currentAsana = asana;
                    break;
                }
            }
        }
        
        console.log(`Secuencia construida para ${seriesName}: ${sequence.length} āsanas`);
        return sequence;
    }


    // Render asana list - VERSIÓN ORDENADA ALFABÉTICAMENTE
    function renderAsanaList() {
        listContainer.innerHTML = '';
        
        if (filteredAsanas.length === 0) {
            listContainer.innerHTML = '<p>NO ASANAS MATCH FILTERS</p>';
            return;
        }
        
        // Ordenar alfabéticamente por Sandhi o Name
        const sortedAsanas = [...filteredAsanas].sort((a, b) => {
            const nameA = (a.Sandhi || a.Name).toLowerCase();
            const nameB = (b.Sandhi || b.Name).toLowerCase();
            return nameA.localeCompare(nameB);
        });
        
        sortedAsanas.forEach(asana => {
            const item = document.createElement('div');
            item.className = 'list-item';
            item.addEventListener('click', () => {
                // Switch to study view and show this asana
                switchSection('study');
                const index = filteredAsanas.findIndex(a => a.ID === asana.ID);
                if (index !== -1) {
                    currentAsanaIndex = index;
                    renderAsanaCard();
                }
            });
            
            const tags = getAsanaTags(asana);
            const tagsHtml = tags.map(tag => `<span class="tag">${tag}</span>`).join('');
            
            item.innerHTML = `
                <h3>${asana.Sandhi.toUpperCase()} - ${asana.English || 'N/A'}</h3>
                <div class="list-tags">
                    ${tagsHtml}
                </div>
            `;
            
            listContainer.appendChild(item);
        });
    }

    // Función para encontrar asana por nombre - MEJORADA
    function findAsanaByName(name) {
        if (!name) return null;
        
        // Limpiar el nombre de búsqueda
        const cleanName = name.trim().toLowerCase();
        
        // Buscar por Name exacto (case insensitive)
        let asana = asanaData.find(a => a.Name.toLowerCase() === cleanName);
        if (asana) return asana;
        
        // Buscar por Sandhi exacto (case insensitive)
        asana = asanaData.find(a => a.Sandhi && a.Sandhi.toLowerCase() === cleanName);
        if (asana) return asana;
        
        // Buscar por coincidencia parcial en Name
        asana = asanaData.find(a => a.Name.toLowerCase().includes(cleanName));
        if (asana) return asana;
        
        // Buscar por coincidencia parcial en Sandhi
        asana = asanaData.find(a => a.Sandhi && a.Sandhi.toLowerCase().includes(cleanName));
        if (asana) return asana;
        
        // Buscar por coincidencia parcial en English name
        asana = asanaData.find(a => a.English && a.English.toLowerCase().includes(cleanName));
        
        return asana || null;
    }

    // Show error message
    function showError(message) {
        errorElement.textContent = message;
        errorElement.style.display = 'block';
    }


    // Inicializar sección Vinyāsa
function initializeVinyasaSection() {
    vinyasaAsanas = asanaData.filter(asana => {
        return asana.SeriesHot && asana.SeriesHot.trim() !== '';
    });
    
    // Ordenar alfabéticamente
    vinyasaAsanas.sort((a, b) => {
        const nameA = (a.Sandhi || a.Name).toLowerCase();
        const nameB = (b.Sandhi || b.Name).toLowerCase();
        return nameA.localeCompare(nameB);
    });
    
    currentVinyasaIndex = 0;
    renderVinyasaCard();
}

// Inicializar sección Aṣṭāṅga
function initializeAshtangaSection() {
    ashtangaAsanas = asanaData.filter(asana => {
        return asana.YogaSeries && asana.YogaSeries.trim() !== '';
    });
    
    // Ordenar por relaciones Before/After
    const seriesGroups = {};
    ashtangaAsanas.forEach(asana => {
        if (asana.YogaSeries && asana.YogaSeries.trim()) {
            const seriesName = asana.YogaSeries.trim();
            if (!seriesGroups[seriesName]) {
                seriesGroups[seriesName] = [];
            }
            seriesGroups[seriesName].push(asana);
        }
    });
    
    // Construir secuencias ordenadas para cada serie
    ashtangaAsanas = [];
    Object.keys(seriesGroups).forEach(seriesName => {
        const sequence = buildSequenceFromRelations(seriesGroups[seriesName], seriesName);
        ashtangaAsanas = ashtangaAsanas.concat(sequence);
    });
    
    currentAshtangaIndex = 0;
    renderAshtangaCard();
}

// Inicializar sección Niṣkriya
function initializeNiskriyaSection() {
    niskriyaAsanas = asanaData.filter(asana => {
        return asana.Yin && asana.Yin.trim() !== '';
    });
    
    // Ordenar alfabéticamente
    niskriyaAsanas.sort((a, b) => {
        const nameA = (a.Sandhi || a.Name).toLowerCase();
        const nameB = (b.Sandhi || b.Name).toLowerCase();
        return nameA.localeCompare(nameB);
    });
    
    currentNiskriyaIndex = 0;
    renderNiskriyaCard();
}

// Renderizar tarjeta Vinyāsa
function renderVinyasaCard() {
    if (vinyasaAsanas.length === 0) {
        vinyasaTitle.textContent = "NO VINYĀSA ASANAS";
        vinyasaImage.style.display = 'none';
        vinyasaDetails.innerHTML = "<p>NO VINYĀSA ASANAS AVAILABLE</p>";
        return;
    }
    
    const asana = vinyasaAsanas[currentVinyasaIndex];
    renderGenericCard(asana, vinyasaTitle, vinyasaImage, vinyasaDetails);
}

// Renderizar tarjeta Aṣṭāṅga
function renderAshtangaCard() {
    if (ashtangaAsanas.length === 0) {
        ashtangaTitle.textContent = "NO AṢṬĀṄGA ASANAS";
        ashtangaImage.style.display = 'none';
        ashtangaDetails.innerHTML = "<p>NO AṢṬĀṄGA ASANAS AVAILABLE</p>";
        return;
    }
    
    const asana = ashtangaAsanas[currentAshtangaIndex];
    renderGenericCard(asana, ashtangaTitle, ashtangaImage, ashtangaDetails);
}

// Renderizar tarjeta Niṣkriya
function renderNiskriyaCard() {
    if (niskriyaAsanas.length === 0) {
        niskriyaTitle.textContent = "NO NIṢKRIYA ASANAS";
        niskriyaImage.style.display = 'none';
        niskriyaDetails.innerHTML = "<p>NO NIṢKRIYA ASANAS AVAILABLE</p>";
        return;
    }
    
    const asana = niskriyaAsanas[currentNiskriyaIndex];
    renderGenericCard(asana, niskriyaTitle, niskriyaImage, niskriyaDetails);
}

// Función genérica para renderizar tarjetas
function renderGenericCard(asana, titleElement, imageElement, detailsElement) {
    titleElement.textContent = asana.Sandhi ? asana.Sandhi.toUpperCase() : asana.Name.toUpperCase();
    
    // Configurar imagen
    imageElement.src = `images/${asana.Name}.png`;
    imageElement.alt = asana.Name;
    imageElement.style.display = 'block';
    imageElement.onerror = function() {
        this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IHg9IjEwMCIgeT0iMTAwIiBmb250LWZhbWlseT0iQ291cmllciBOZXcsIG1vbm9zcGFjZSIgZm9udC1zaXplPSIxNCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgZmlsbD0iI2ZmZmZmZiI+Tk8gSU1BR0UgQVZBSUxBQkxFPC90ZXh0Pjwvc3ZnPg==';
        this.alt = 'IMAGE NOT AVAILABLE';
        this.style.filter = 'grayscale(100%)';
    };
    
    // Renderizar detalles (usando la misma lógica que renderAsanaCard pero simplificada)
    let detailsHTML = '';
    
    if (asana.English) {
        detailsHTML += `
            <div class="detail-row">
                <span class="detail-label">ENGLISH:</span>
                <span>${asana.English}</span>
            </div>`;
    }
    
    if (asana.Devanagari) {
        detailsHTML += `
            <div class="detail-row">
                <span class="detail-label">DEVANAGARI:</span>
                <span>${asana.Devanagari}</span>
            </div>`;
    }
    
    if (asana.Etymology) {
        detailsHTML += `
            <div class="detail-row">
                <span class="detail-label">ETYMOLOGY:</span>
                <span>${asana.Etymology}</span>
            </div>`;
    }
    
    // Para Aṣṭāṅga, mostrar relaciones Before/After
    if (asana.Before) {
        const beforeAsana = findAsanaByName(asana.Before);
        const beforeDisplayName = beforeAsana ? (beforeAsana.Sandhi || beforeAsana.Name) : asana.Before;
        detailsHTML += `
            <div class="detail-row">
                <span class="detail-label">BEFORE:</span>
                <span>${beforeDisplayName}</span>
            </div>`;
    }
    
    if (asana.After) {
        const afterAsana = findAsanaByName(asana.After);
        const afterDisplayName = afterAsana ? (afterAsana.Sandhi || afterAsana.Name) : asana.After;
        detailsHTML += `
            <div class="detail-row">
                <span class="detail-label">AFTER:</span>
                <span>${afterDisplayName}</span>
            </div>`;
    }
    
    detailsElement.innerHTML = detailsHTML || '<p>NO DETAILS AVAILABLE</p>';
}

async function init() {
    try {
        await loadCSVData();
        await loadLexiconData();
        
        console.log('Total asanas cargadas:', asanaData.length);
        console.log('Total términos cargados:', lexiconData.length);
        
        // Inicializar léxico
        filteredLexicon = shuffleArray([...lexiconData]);
        renderLexiconCard();
        renderLexiconList();
        
        populateTagFilters();
        
        // Activar Sākṣāt por defecto
        const saksatBtn = document.querySelector('[data-tag="Sākṣāt"]');
        if (saksatBtn) {
            saksatBtn.classList.add('active');
            activeTags.add('Sākṣāt');
        }
        
        applyFilters();
        
        // INICIALIZAR LAS NUEVAS SECCIONES
        initializeVinyasaSection();
        initializeAshtangaSection();
        initializeNiskriyaSection();
        
        setupEventListeners();
        
        console.log('Aplicación inicializada correctamente');
    } catch (error) {
        console.error('Error en init:', error);
        showError(`Failed to load data: ${error.message}`);
    }
}

    // Load CSV data
    async function loadCSVData() {
        loadingElement.style.display = 'block';
        
        try {
            const response = await fetch('asana.csv');
            if (!response.ok) throw new Error('CSV file not found');
            
            const csvText = await response.text();
            
            return new Promise((resolve, reject) => {
                Papa.parse(csvText, {
                    header: true,
                    skipEmptyLines: true,
                    complete: function(results) {
                        loadingElement.style.display = 'none';
                        
                        if (results.errors.length > 0) {
                            reject(new Error(results.errors[0].message));
                            return;
                        }
                        
                        asanaData = results.data.map(row => {
                            const cleanRow = {};
                            for (const key in row) {
                                cleanRow[key] = row[key] ? row[key].trim() : '';
                            }
                            return cleanRow;
                        });
                        
                        // Calculate tags AFTER loading data
                        allTags = ['Sākṣāt', 'aṣṭāṅga', 'vinyāsa', 'niṣkriya', 'Cālanī'];
                        
                        resolve(asanaData);
                    },
                    error: function(error) {
                        loadingElement.style.display = 'none';
                        reject(new Error(`Failed to parse CSV: ${error.message}`));
                    }
                });
            });
        } catch (error) {
            loadingElement.style.display = 'none';
            throw error;
        }
    }

    // Populate tag filters
    function populateTagFilters() {
        // Clear existing tag buttons
        menuTagFilters.innerHTML = '';
        
        allTags.forEach(tag => {
            const button = document.createElement('button');
            button.className = 'menu-tag-btn brutalist-btn';
            button.innerHTML = tag;
            button.dataset.tag = tag;
            button.addEventListener('click', toggleTagFilter);
            menuTagFilters.appendChild(button);
            
            // Activar Sākṣāt por defecto
            if (tag === 'Sākṣāt') {
                button.classList.add('active');
                activeTags.add('Sākṣāt');
            }
        });
    }

    // Toggle tag filter
    function toggleTagFilter(e) {
        const tag = e.target.dataset.tag;
        
        if (tag === 'Sākṣāt') {
            // Reset all filters
            activeTags.clear();
            document.querySelectorAll('.menu-tag-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            e.target.classList.add('active');
            activeTags.add('Sākṣāt');
        } else if (tag === 'Cālanī') {
            // Show advanced filters modal
            showAdvancedFilters();
            return;
        } else {
            // Remove Sākṣāt if another tag is selected
            if (activeTags.has('Sākṣāt')) {
                activeTags.delete('Sākṣāt');
                document.querySelectorAll('.menu-tag-btn').forEach(btn => {
                    if (btn.dataset.tag === 'Sākṣāt') {
                        btn.classList.remove('active');
                    }
                });
            }
            
            if (activeTags.has(tag)) {
                activeTags.delete(tag);
                e.target.classList.remove('active');
            } else {
                activeTags.add(tag);
                e.target.classList.add('active');
            }
        }
        
        applyFilters();
    }

    // Show advanced filters modal
    function showAdvancedFilters() {
        // Create modal for advanced filters
        const modal = document.createElement('div');
        modal.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        `;
        
        modal.innerHTML = `
            <div style="background: var(--primary-color); border: 4px solid var(--accent-color); padding: 20px; max-width: 500px; width: 90%;">
                <h3 style="color: var(--accent-color); margin-bottom: 20px; text-transform: uppercase;">CĀLANĪ - FILTROS AVANZADOS</h3>
                
                <div style="margin-bottom: 20px;">
                    <h4 style="color: var(--accent-color); margin-bottom: 10px; border-bottom: 2px solid var(--accent-color);">AṢṬĀṄGA</h4>
                    <div id="ashtanga-filters" style="display: flex; flex-direction: column; gap: 5px;">
                        ${Object.values(seriesMapping).map(series => `
                            <label style="color: var(--accent-color); cursor: pointer;">
                                <input type="checkbox" value="${Object.keys(seriesMapping).find(key => seriesMapping[key] === series)}" style="margin-right: 8px;">
                                ${series}
                            </label>
                        `).join('')}
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h4 style="color: var(--accent-color); margin-bottom: 10px; border-bottom: 2px solid var(--accent-color);">VINYĀSA</h4>
                    <div id="vinyasa-filters" style="display: flex; flex-direction: column; gap: 5px;">
                        ${Object.values(seriesHotMapping).map(series => `
                            <label style="color: var(--accent-color); cursor: pointer;">
                                <input type="checkbox" value="${Object.keys(seriesHotMapping).find(key => seriesHotMapping[key] === series)}" style="margin-right: 8px;">
                                ${series}
                            </label>
                        `).join('')}
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button id="apply-advanced" style="background: var(--accent-color); color: #fff; border: 2px solid var(--accent-color); padding: 8px 16px; cursor: pointer; text-transform: uppercase;">APLICAR</button>
                    <button id="cancel-advanced" style="background: var(--accent-color); color: #fff; border: 2px solid var(--accent-color); padding: 8px 16px; cursor: pointer; text-transform: uppercase;">CANCELAR</button>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        
        // Event listeners for modal
        document.getElementById('apply-advanced').addEventListener('click', function() {
            const selectedAshtanga = Array.from(document.querySelectorAll('#ashtanga-filters input:checked')).map(input => input.value);
            const selectedVinyasa = Array.from(document.querySelectorAll('#vinyasa-filters input:checked')).map(input => input.value);
            
            // Apply advanced filters
            applyAdvancedFilters(selectedAshtanga, selectedVinyasa);
            document.body.removeChild(modal);
        });
        
        document.getElementById('cancel-advanced').addEventListener('click', function() {
            document.body.removeChild(modal);
        });
    }

    // Apply advanced filters
    function applyAdvancedFilters(selectedAshtanga, selectedVinyasa) {
        // Clear previous filters
        activeTags.clear();
        document.querySelectorAll('.menu-tag-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        // Add advanced filters to active tags
        if (selectedAshtanga.length > 0) {
            activeTags.add('aṣṭāṅga');
            document.querySelector('[data-tag="aṣṭāṅga"]').classList.add('active');
        }
        
        if (selectedVinyasa.length > 0) {
            activeTags.add('vinyāsa');
            document.querySelector('[data-tag="vinyāsa"]').classList.add('active');
        }
        
        // Store advanced filter selections
        activeTags.advancedAshtanga = selectedAshtanga;
        activeTags.advancedVinyasa = selectedVinyasa;
        
        applyFilters();
    }

    // Apply filters to asana data - CORREGIDA
    function applyFilters() {
        filteredAsanas = asanaData.filter(asana => {
            // Filter by tags
            if (activeTags.has('Sākṣāt')) {
                return true; // Show all asanas
            }
            
            let matchesTag = false;
            
            // Check aṣṭāṅga filter
            if (activeTags.has('aṣṭāṅga')) {
                if (activeTags.advancedAshtanga && activeTags.advancedAshtanga.length > 0) {
                    // Advanced aṣṭāṅga filter
                    if (activeTags.advancedAshtanga.includes(asana.YogaSeries)) {
                        matchesTag = true;
                    }
                } else if (asana.Ashtanga) {
                    // Basic aṣṭāṅga filter
                    matchesTag = true;
                }
            }
            
            // Check vinyāsa filter
            if (activeTags.has('vinyāsa')) {
                if (activeTags.advancedVinyasa && activeTags.advancedVinyasa.length > 0) {
                    // Advanced vinyāsa filter
                    if (activeTags.advancedVinyasa.includes(asana.SeriesHot)) {
                        matchesTag = true;
                    }
                } else if (asana.Baptiste) {
                    // Basic vinyāsa filter
                    matchesTag = true;
                }
            }
            
            // Check niṣkriya filter
            if (activeTags.has('niṣkriya') && asana.Yin) {
                matchesTag = true;
            }
            
            return matchesTag;
        });
        
        // SOLO MEZCLAR ALEATORIAMENTE CUANDO EL FILTRO ACTIVO ES SĀKṢĀT
        if (activeTags.has('Sākṣāt')) {
            filteredAsanas = shuffleArray(filteredAsanas);
        } else {
            // Para otros filtros, mantener orden alfabético
            filteredAsanas.sort((a, b) => {
                const nameA = (a.Sandhi || a.Name).toLowerCase();
                const nameB = (b.Sandhi || b.Name).toLowerCase();
                return nameA.localeCompare(nameB);
            });
        }
        
        // Reset current index
        currentAsanaIndex = 0;
        
        renderAsanaCard();
        renderAsanaList();
    }
    

// Render current asana card
function renderAsanaCard() {
    if (filteredAsanas.length === 0) {
        cardTitle.textContent = "NO ASANAS MATCH FILTERS";
        cardImage.src = "";
        cardDetails.innerHTML = "<p>ADJUST FILTERS TO SEE ASANAS</p>";
        
        // Ocultar controles de Aṣṭāṅga
        ashtangaSequenceControls.style.display = 'none';
        return;
    }
    
    const asana = filteredAsanas[currentAsanaIndex];
    // MOSTRAR EL SANDHI EN EL TÍTULO
    cardTitle.textContent = asana.Sandhi ? asana.Sandhi.toUpperCase() : asana.Name.toUpperCase();
    
    // Set image - using the local image path
    cardImage.src = `images/${asana.Name}.png`;
    cardImage.alt = asana.Name;
    cardImage.style.display = 'block';
    
    // Handle missing images
    cardImage.onerror = function() {
        this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IHg9IjEwMCIgeT0iMTAwIiBmb250LWZhbWlseT0iQ291cmllciBOZXcsIG1vbm9zcGFjZSIgZm9udC1zaXplPSIxNCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgZmlsbD0iI2ZmZmZmZiI+Tk8gSU1BR0UgQVZBSUxBQkxFPC90ZXh0Pjwvc3ZnPg==';
        this.alt = 'IMAGE NOT AVAILABLE';
        this.style.filter = 'grayscale(100%)';
    };
    

    
    // Función para convertir [[AsanaName]] en enlaces
    function createAsanaLinks(text) {
        if (!text) return 'N/A';
        return text.replace(/\[\[(.*?)\]\]/g, function(match, asanaName) {
            return `<a href="#" class="asana-link" data-asana="${asanaName}">${asanaName}</a>`;
        });
    }

    // HTML básico (siempre visible) - SERIES Y BEFORE/AFTER
    let basicHTML = '';
    
    // AGREGAR HOT SERIES SI EXISTE (MAPEADO) - FUERA DE DETAILS
    if (asana.SeriesHot) {
        const mappedHotSeries = seriesHotMapping[asana.SeriesHot] || asana.SeriesHot;
        basicHTML += `
        <div class="detail-row">
            <span class="detail-label">VINYĀSA Series:</span>
            <span style="font-weight: bold; font-style: italic; color: #f6442fff">${mappedHotSeries}</span>
        </div>`;
    }

    // AGREGAR YOGA SERIES SI EXISTE (MAPEADO) - FUERA DE DETAILS
    if (asana.YogaSeries) {
        const mappedYogaSeries = seriesMapping[asana.YogaSeries] || asana.YogaSeries;
        basicHTML += `
        <div class="detail-row">
            <span class="detail-label">aṣṭāṅga Series:</span>
            <span style="font-weight: bold; font-style: italic; color: #f6442fff">${mappedYogaSeries}</span>
        </div>`;
    }

    // AGREGAR BEFORE SOLO SI EXISTE - FUERA DE DETAILS
    if (asana.Before) {
        const beforeAsana = findAsanaByName(asana.Before);
        const beforeDisplayName = beforeAsana ? (beforeAsana.Sandhi || beforeAsana.Name) : asana.Before;
        
        basicHTML += `
        <div class="detail-row">
            <span class="detail-label">BEFORE:</span>
            <span><a href="#" class="asana-link" data-asana="${asana.Before}">${beforeDisplayName}</a></span>
        </div>`;
    }

    // AGREGAR AFTER SOLO SI EXISTE - FUERA DE DETAILS
    if (asana.After) {
        const afterAsana = findAsanaByName(asana.After);
        const afterDisplayName = afterAsana ? (afterAsana.Sandhi || afterAsana.Name) : asana.After;
        
        basicHTML += `
        <div class="detail-row">
            <span class="detail-label">AFTER:</span>
            <span><a href="#" class="asana-link" data-asana="${asana.After}">${afterDisplayName}</a></span>
        </div>`;
    }

    // Botón de toggle
    basicHTML += `
        <button class="details-toggle brutalist-btn" id="details-toggle">
            DETAILS ›
        </button>
        
        <div class="details-content" id="details-content">
    `;

    // HTML de detalles expandidos (inicialmente oculto)
    let detailsHTML = '';

    // INFORMACIÓN BÁSICA MOVIDA A DETALLES
    detailsHTML += `
        <div class="basic-details">
            <div class="detail-row">
                <span class="detail-label">DEVANAGARI:</span>
                <span>${asana.Devanagari || 'N/A'}</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">ENGLISH:</span>
                <span>${asana.English || 'N/A'}</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">ETYMOLOGY:</span>
                <span>${asana.Etymology || 'N/A'}</span>
            </div>
        </div>
    `;

    // AGREGAR NUEVAS COLUMNAS SI NO ESTÁN VACÍAS
    if (asana.Open && asana.Open.trim() !== '') {
        detailsHTML += `
        <div class="detail-row">
            <span class="detail-label">OPEN:</span>
            <span>${asana.Open}</span>
        </div>`;
    }

    if (asana.OpenAsana && asana.OpenAsana.trim() !== '') {
        detailsHTML += `
        <div class="detail-row">
            <span class="detail-label">OPEN ĀSANA:</span>
            <span>${createAsanaLinks(asana.OpenAsana)}</span>
        </div>`;
    }

    if (asana.Stable && asana.Stable.trim() !== '') {
        detailsHTML += `
        <div class="detail-row">
            <span class="detail-label">STABLE:</span>
            <span>${asana.Stable}</span>
        </div>`;
    }

    if (asana.StableAsana && asana.StableAsana.trim() !== '') {
        detailsHTML += `
        <div class="detail-row">
            <span class="detail-label">STABLE ĀSANA:</span>
            <span>${createAsanaLinks(asana.StableAsana)}</span>
        </div>`;
    }

    if (asana.Preparation && asana.Preparation.trim() !== '') {
        detailsHTML += `
        <div class="detail-row">
            <span class="detail-label">PREPARATION FOR:</span>
            <span>${createAsanaLinks(asana.Preparation)}</span>
        </div>`;
    }

    if (asana.Counterposes && asana.Counterposes.trim() !== '') {
        detailsHTML += `
        <div class="detail-row">
            <span class="detail-label">COUNTER ĀSANA:</span>
            <span>${createAsanaLinks(asana.Counterposes)}</span>
        </div>`;
    }
    
    // Siempre mostrar TAGS
    detailsHTML += `
        <div class="detail-row">
            <span class="detail-label">TAGS:</span>
            <span style="font-style: italic; color: #f6442fff">${getAsanaTags(asana).join(', ') || 'N/A'}</span>
        </div>
    `;

    // Combinar todo el HTML
    const fullHTML = basicHTML + detailsHTML + '</div>';
    cardDetails.innerHTML = fullHTML;

    // Configurar el evento del toggle
    const toggleBtn = document.getElementById('details-toggle');
    const detailsContent = document.getElementById('details-content');
    
    if (toggleBtn && detailsContent) {
        toggleBtn.addEventListener('click', function() {
            const isExpanded = detailsContent.classList.toggle('expanded');
            this.innerHTML = isExpanded ? 'DETAILS ▽' : 'DETAILS ›';
        });
    }

    // Agregar event listeners para los enlaces de asanas
    cardDetails.querySelectorAll('.asana-link').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const asanaName = this.dataset.asana;
            const asana = findAsanaByName(asanaName);
            if (asana) {
                // Buscar en filteredAsanas
                const filteredIndex = filteredAsanas.findIndex(a => a.Name === asana.Name);
                if (filteredIndex !== -1) {
                    currentAsanaIndex = filteredIndex;
                    renderAsanaCard();
                } else {
                    // Si no está en los filtros actuales, cambiar a Sākṣāt y buscar
                    activeTags.clear();
                    document.querySelectorAll('.menu-tag-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    const saksatBtn = document.querySelector('[data-tag="Sākṣāt"]');
                    if (saksatBtn) {
                        saksatBtn.classList.add('active');
                        activeTags.add('Sākṣāt');
                    }
                    applyFilters();
                    
                    // Buscar la asana en los nuevos filteredAsanas
                    const newIndex = filteredAsanas.findIndex(a => a.Name === asana.Name);
                    if (newIndex !== -1) {
                        currentAsanaIndex = newIndex;
                        renderAsanaCard();
                    }
                }
            }
        });
    });
}
    
    // Get tags for an asana display
    function getAsanaTags(asana) {
        const tags = [];
        if (asana.Ashtanga) tags.push("aṣṭāṅga");
        if (asana.Yin) tags.push("niṣkriya");
        if (asana.Baptiste) tags.push("vinyāsa");
        if (asana.SeriesHot) {
            const mapped = seriesHotMapping[asana.SeriesHot];
            tags.push(mapped ? mapped.split(' - ')[0] : asana.SeriesHot);
        }
        if (asana.YogaSeries) {
            const mapped = seriesMapping[asana.YogaSeries];
            tags.push(mapped ? mapped.split(' - ')[0] : asana.YogaSeries);
        }
        return tags;
    }

function switchSection(sectionId) {
    // Actualizar clases del body para cambiar colores
    document.body.className = '';
    
    // Agregar clase específica para cada sección
    if (sectionId === 'study') {
        document.body.classList.add('study-section');
    } else if (sectionId === 'vinyasa') {
        document.body.classList.add('vinyasa-section');
    } else if (sectionId === 'ashtanga') {
        document.body.classList.add('ashtanga-section');
    } else if (sectionId === 'niskriya') {
        document.body.classList.add('niskriya-section');
    } else if (sectionId === 'lexicon') {
        document.body.classList.add('lexicon-section');
    } else if (sectionId === 'lexicon-list') {
        document.body.classList.add('lexicon-list-section');
    } else if (sectionId === 'about') {
        document.body.classList.add('about-section');
    }
    
    // Update nav buttons
    menuNavButtons.forEach(btn => {
        if (btn.dataset.section === sectionId) {
            btn.classList.add('active');
        } else {
            btn.classList.remove('active');
        }
    });
    
    // Show/hide sections
    document.querySelectorAll('.section').forEach(section => {
        if (section.id === sectionId) {
            section.classList.add('active');
        } else {
            section.classList.remove('active');
        }
    });
    
    // Cerrar menús después de seleccionar
    menuContent.classList.remove('active');
    filterContent.classList.remove('active');
}


function setupEventListeners() {
    // Menu toggle
    burgerBtn.addEventListener('click', () => {
        menuContent.classList.toggle('active');
        // Cerrar filtros si están abiertos
        filterContent.classList.remove('active');
    });
    
    // Filter toggle
    filterBtn.addEventListener('click', () => {
        filterContent.classList.toggle('active');
        // Cerrar menú principal si está abierto
        menuContent.classList.remove('active');
    });
    
    // Navigation
    menuNavButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            switchSection(btn.dataset.section);
        });
    });
    
    // Controles de la sección principal
    prevBtn.addEventListener('click', () => {
        if (filteredAsanas.length === 0) return;
        currentAsanaIndex = (currentAsanaIndex - 1 + filteredAsanas.length) % filteredAsanas.length;
        renderAsanaCard();
    });
    
    nextBtn.addEventListener('click', () => {
        if (filteredAsanas.length === 0) return;
        currentAsanaIndex = (currentAsanaIndex + 1) % filteredAsanas.length;
        renderAsanaCard();
    });
    
    // Controles Vinyāsa
    vinyasaPrevBtn.addEventListener('click', () => {
        if (vinyasaAsanas.length === 0) return;
        currentVinyasaIndex = (currentVinyasaIndex - 1 + vinyasaAsanas.length) % vinyasaAsanas.length;
        renderVinyasaCard();
    });
    
    vinyasaNextBtn.addEventListener('click', () => {
        if (vinyasaAsanas.length === 0) return;
        currentVinyasaIndex = (currentVinyasaIndex + 1) % vinyasaAsanas.length;
        renderVinyasaCard();
    });
    
    // Controles Aṣṭāṅga
    ashtangaPrevBtn.addEventListener('click', () => {
        if (ashtangaAsanas.length === 0) return;
        currentAshtangaIndex = (currentAshtangaIndex - 1 + ashtangaAsanas.length) % ashtangaAsanas.length;
        renderAshtangaCard();
    });
    
    ashtangaNextBtn.addEventListener('click', () => {
        if (ashtangaAsanas.length === 0) return;
        currentAshtangaIndex = (currentAshtangaIndex + 1) % ashtangaAsanas.length;
        renderAshtangaCard();
    });
    
    // Controles Niṣkriya
    niskriyaPrevBtn.addEventListener('click', () => {
        if (niskriyaAsanas.length === 0) return;
        currentNiskriyaIndex = (currentNiskriyaIndex - 1 + niskriyaAsanas.length) % niskriyaAsanas.length;
        renderNiskriyaCard();
    });
    
    niskriyaNextBtn.addEventListener('click', () => {
        if (niskriyaAsanas.length === 0) return;
        currentNiskriyaIndex = (currentNiskriyaIndex + 1) % niskriyaAsanas.length;
        renderNiskriyaCard();
    });
    
    // Search
    searchBox.addEventListener('input', (e) => {
        const searchTerm = e.target.value.toLowerCase();
        filteredAsanas = asanaData.filter(asana => 
            asana.Name.toLowerCase().includes(searchTerm) ||
            asana.English.toLowerCase().includes(searchTerm) ||
            asana.Sandhi.toLowerCase().includes(searchTerm)
        );
        filteredAsanas = shuffleArray(filteredAsanas);
        currentAsanaIndex = 0;
        renderAsanaList();
        if (document.getElementById('study').classList.contains('active')) {
            renderAsanaCard();
        }
    });
    
    // Lexicon controls
    lexiconPrevBtn.addEventListener('click', () => {
        if (filteredLexicon.length === 0) return;
        currentLexiconIndex = (currentLexiconIndex - 1 + filteredLexicon.length) % filteredLexicon.length;
        renderLexiconCard();
    });
    
    lexiconNextBtn.addEventListener('click', () => {
        if (filteredLexicon.length === 0) return;
        currentLexiconIndex = (currentLexiconIndex + 1) % filteredLexicon.length;
        renderLexiconCard();
    });
    
    // Lexicon search
    lexiconSearchBox.addEventListener('input', (e) => {
        const searchTerm = e.target.value.toLowerCase();
        
        if (searchTerm.trim() === '') {
            filteredLexicon = [...lexiconData];
        } else {
            filteredLexicon = lexiconData.filter(term => {
                return (
                    (term.term && term.term.toLowerCase().includes(searchTerm)) ||
                    (term.devanāgarī && term.devanāgarī.includes(searchTerm)) ||
                    (term.meaning && term.meaning.toLowerCase().includes(searchTerm))
                );
            });
        }
        
        filteredLexicon = shuffleArray(filteredLexicon);
        currentLexiconIndex = 0;
        renderLexiconList();
        if (document.getElementById('lexicon').classList.contains('active')) {
            renderLexiconCard();
        }
    });

    // Cerrar menús cuando se hace click fuera
    document.addEventListener('click', (e) => {
        if (!menuContent.contains(e.target) && !burgerBtn.contains(e.target)) {
            menuContent.classList.remove('active');
        }
        if (!filterContent.contains(e.target) && !filterBtn.contains(e.target)) {
            filterContent.classList.remove('active');
        }
    });
    
    // Inicializar mejoras touch
    setupTouchImprovements();
}


    // Initialize the app when the page loads
    document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>